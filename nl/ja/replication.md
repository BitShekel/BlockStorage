---

copyright:
  years: 2015, 2018
lastupdated: "2018-04-25"

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}

# レプリケーションの処理

レプリケーションでは、いずれかのスナップショット・スケジュールを使用して、スナップショットが自動的にリモート・データ・センター内の宛先ボリュームにコピーされます。 データの破損や壊滅的な状況が発生した場合、コピーをリモート・サイトでリカバリーすることができます。

レプリカを使用して実行できること

- 宛先ボリュームにフェイルオーバーすることにより、サイトの障害やその他の災害から迅速にリカバリーする。
- DR コピーの特定のポイント・イン・タイムにフェイルオーバーする。

レプリケーションを行うには、事前に、まずスナップショット・スケジュールを作成しておく必要があります。 フェイルオーバーすると、プライマリー・データ・センター内のストレージ・ボリュームからリモート・データ・センター内の宛先ボリュームへの「反転切り替え」が行われます。 例えば、プライマリー・データ・センターがロンドンにあり、2 次データ・センターがアムステルダムにあるとします。 障害が発生した場合は、アムステルダムにフェイルオーバーします。つまり、アムステルダムにあるコンピューティング・インスタンスの新たにプライマリーになったボリュームに接続します。 ロンドンにあるボリュームが修復された後、ロンドンにフォールバックして、再びプライマリーになったロンドンのコンピューティング・インスタンスのボリュームに接続するために、アムステルダムのボリュームのスナップショットが取得されます。


**注:** 特に断りがない限り、{{site.data.keyword.blockstoragefull}} とファイル・ストレージのどちらでも手順は同じです。

## 複製されたストレージ・ボリュームのリモート・データ・センターの判別方法

{{site.data.keyword.BluSoftlayer_full}} のワールドワイド・データ・センターは、プライマリーとリモートを組み合わせたペアになっています。
使用可能なデータ・センターとレプリケーション・ターゲットの完全なリストについては、表 1 を参照してください。
一部の都市 (ダラス、サンノゼ、ワシントン DC、アムステルダムなど) では、複数のデータ・センターがあることに注意してください。


<table cellpadding="1" cellspacing="1">
	<caption>表 1</caption>
	<tbody>
		<tr>
			<td><strong>米国 1</strong><sup><img src="/images/numberone.png" alt="1" /></sup></td>
			<td><strong>米国 2</strong></td>
			<td><strong>ラテン/南アメリカ</strong></td>
			<td><strong>カナダ</strong></td>
			<td><strong>ヨーロッパ</strong></td>
			<td><strong>アジア太平洋地域</strong></td>
			<td><strong>オーストラリア</strong></td>
		</tr>
		<tr>
			<td>DAL01<br />
				DAL05<br />
				DAL06<br />
				HOU02<br />
				SJC01<br />
				WDC01<br />
				<br />
				<br />
				<br /><br />
			</td>
			<td>SJC03<br />
				SJC04<br />
				WDC04<br />
				WDC06<br />
				WDC07<br />
				DAL09<br />
				DAL10<br />
				DAL12<br />
				DAL13<br /><br />
			</td>
			<td>MEX01<br />
				SAO01<br /><br /><br /><br /><br /><br /><br /><br /><br />
			</td>
			<td>TOR01<br />
				MON01<br /><br /><br /><br /><br /><br /><br /><br /><br />
			</td>
			<td>
				AMS01<br />
				AMS03<br />
				FRA02<br />
				FRA04<br />
				LON02<br />
				LON04<br />
				LON06<br />
				OSL01<br />
				PAR01<br />
				MIL01<br />
			</td>
			<td>HKG02<br />
				TOK02<br />
				SNG01<br />
				SEO01<br />
                                CHE01<br />
				<br />
				<br />
				<br />
				<br />
				<br />
			</td>
			<td>
				SYD01<br />
				SYD04<br />
				MEL01<br />
				<br /><br /><br /><br /><br /><br /><br />
			</td>
		</tr>
		<tr>
			<td colspan="100%"><p><sup><img src="/images/numberone.png" alt="1" /></sup>この地域のデータ・センターには、暗号化されたストレージがありません。<br /><strong>注</strong>: 暗号化されたストレージがあるデータ・センターは、暗号化されていないデータ・センターをレプリカ・ターゲットとして使用してレプリケーションを開始することは<strong>できません</strong>。</p>
			</td>
		</tr>
	</tbody>
</table>


## 初期レプリケーションの作成方法

レプリケーションは、スナップショット・スケジュールから機能します。 レプリケーションを行うには、事前に、まずソース・ボリューム用のスナップショット・スペースとスナップショット・スケジュールをセットアップしておく必要があります。 レプリケーションをセットアップしようとしたときに、そのどちらかの準備ができていない場合は、スペースの購入やスケジュールのセットアップが必要であることを知らせるプロンプトが表示されます。 レプリケーションの管理は、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}から、「ストレージ」、「{{site.data.keyword.blockstorageshort}}」または「ファイル・ストレージ」で行います。

1. ストレージ・ボリュームをクリックします。
2. **「レプリカ」**タブをクリックして、**「レプリケーションの購入」**リンクをクリックします。
レプリケーションに使用する既存のスナップショット・スケジュールを選択します。 リストに、アクティブなすべてのスナップショット・スケジュールが示されます。 <br />
  **注:**: 時間単位、日単位、および週単位が混在する場合でも、選択できるスケジュールは 1 つだけです。  前回のレプリケーション・サイクル以降に収集されたすべてのスナップショットは、発生元のスケジュールに関係なく複製されます。<br />
  **注:** スナップショットのセットアップが済んでいない場合は、レプリケーションを注文する前にセットアップを行うよう、プロンプトが表示されます。 詳しくは、[スナップショットの処理](snapshots.html)を参照してください。
3. **「ロケーション」**ドロップダウンの矢印をクリックして、DR サイトにするデータ・センターを選択します。
4. **「続行」**をクリックします。
5. **プロモーション・コード**を入力して (ある場合)、**「再計算」**をクリックします。 ダイアログボックス内の他のフィールドにデフォルト値が設定されます。
6. **「マスター・サービス契約を読み... (I have read the Master Service Agreement…)」**チェック・ボックスをクリックして、**「注文する (Place Order)」**をクリックします。


## 既存のレプリケーションの編集方法

[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}で、**「ストレージ」**、**「{{site.data.keyword.blockstorageshort}}」**の**「プライマリー (Primary)」**または**「レプリカ」**のいずれかのタブから、レプリケーション・スケジュールを編集し、レプリケーション・スペースを変更することができます。



## レプリケーション・スケジュールの編集方法

レプリケーション・スケジュールは既存のスナップショット・スケジュールに基づいているため、実際にはスナップショット・スケジュールを変更することになります。 レプリカのスケジュールを (例えば、時間単位から週単位に) 変更するには、レプリケーション・スケジュールをキャンセルして新規のスケジュールをセットアップする必要があります。

スケジュールの変更は、「プライマリー (Primary)」タブまたは「レプリカ」タブで行うことができます。

1. **「プライマリー (Primary)」**または**「レプリカ」**のいずれかのタブで、**「アクション」**ドロップダウン・メニューをクリックします。
2. **「スナップショット・スケジュールの編集」**を選択します。
3. 「スケジュール」の下の「スナップショット」フレームで、レプリケーションに使用しているスケジュールを判別します。 レプリケーションに使用されているスケジュールに変更を加えます。例えば、レプリケーション・スケジュールが**「日単位」**である場合は、レプリケーションが実行される時刻を変更できます。
4. **「保存」**をクリックします。


## レプリケーション・スペースの変更方法

プライマリー・スナップショット・スペースとレプリカ・スペースは同じものであることが必要です。 **「プライマリー (Primary)」**タブまたは**「レプリカ」**タブでスペースを変更すると、ソースと宛先の両方のデータ・センターに自動的にスペースが追加されます。 スナップショット・スペースを増やすと、即時にレプリケーションの更新がトリガーされることに注意してください。

**「プライマリー (Primary)」**または**「レプリカ」**のいずれかのタブで、**「アクション」**ドロップダウン・メニューをクリックします。
**「スナップショット・スペースの追加」**を選択します。
リストからストレージ・サイズを選択して、**「続行」**をクリックします。
**プロモーション・コード**を入力して (ある場合)、**「再計算」**をクリックします。 ダイアログボックス内の他のフィールドにデフォルト値が設定されます。
「マスター・サービス契約を読み... (I have read the Master Service Agreement…)」チェック・ボックスをクリックして、「注文する (Place Order)」ボタンをクリックします。


## ボリューム・リストでのレプリカ・ボリュームの表示方法

**「ストレージ」>「{{site.data.keyword.blockstorageshort}}」**で「{{site.data.keyword.blockstorageshort}}」ページからレプリケーション・ボリュームを表示できます。 「LUN 名」は、プライマリー・ボリュームの名前の後に REP を付けたものになります。 「タイプ」は「endurance (パフォーマンス) – レプリカ」で、「ターゲット・アドレス」は「 N/A 」(レプリカ・ボリュームはレプリカ・データ・センターでマウントされていないため)、「状況」は「非アクティブ」です。



## レプリカ・データ・センターにある複製されたボリュームの詳細の表示方法

**「ストレージ」**、**「{{site.data.keyword.blockstorageshort}}」**の**「レプリカ」**タブで、レプリカ・ボリュームの詳細を表示できます。 もう 1 つのオプションとしては、**「{{site.data.keyword.blockstorageshort}}」**ページからレプリカ・ボリュームを選択して、**「レプリカ」**タブをクリックします。



## 2 次データ・センターへのフェイルオーバーの前にホスト許可を指定する方法

許可されたホストとボリュームは、同じデータ・センター内に存在する必要があります。 レプリカ・ボリュームをロンドンに持ち、ホストをアムステルダムに持つことはできません。両方がロンドンに存在するか、両方がアムステルダムに存在する必要があります。

1. ソース・ボリュームまたは宛先ボリュームを、そのいずれかの**「{{site.data.keyword.blockstorageshort}}」**ページでクリックします。
2. **「レプリカ」**タブをクリックします。
3. **「ホストの許可」**フレームまでスクロールダウンして、画面の右側にある**「ホストの許可」**リンクをクリックします。
4. レプリケーション用に許可するホストを強調表示します。 複数のホストを選択するには、Ctrl キーを使用して該当するホストをクリックします。
5. **「送信」**をクリックします。 ホストがない場合は、ダイアログ・ボックスに同じデータ・センター内のコンピューティング・リソースを購入するオプションが提示されるか、**「閉じる」**をクリックすることができます。


## 「マイ・プライマリー・データ・センター (My Primary Data Center)」のスペースを増やすときに、「マイ・レプリカ・データ・センター(My Replica Data Center)」の「マイ・スナップショット・スペース (My Snapshot Space)」を増やす方法

プライマリーとレプリカのストレージ・ボリュームで、ボリューム・サイズが同じであることが必要です。一方をもう一方より大きくすることはできません。 プライマリー・ボリュームのスナップショット・スペースを増やすと、レプリカ・スペースも自動的に増えます。 スナップショット・スペースを増やすと、即時にレプリケーションの更新がトリガーされることに注意してください。 両方のボリュームの増加は、請求書に行項目として表示され、必要に応じて日割り計算されます。

スナップショット・スペースを増やす方法については、[ここ](snapshots.html)をクリックしてください。



## ボリュームからそのレプリカへのフェイルオーバーの開始方法

障害が発生した場合は、**「フェイルオーバー」**アクションを使用して、宛先 (つまりターゲット) ボリュームへのフェイルオーバーを開始することができます。 ターゲット・ボリュームがアクティブになり、最後に正常に複製されたスナップショットがアクティブ化され、ボリュームがマウント用にアクティブになります。 前回のレプリケーション・サイクル以降にソース・ボリュームに書き込まれたデータは、すべて破棄されます。 フェイルオーバーが開始されると、**レプリケーション関係が反転する**ことに注意してください。 ターゲット・ボリュームはソース・ボリュームになり、以前のソース・ボリュームは、**「LUN 名」**の後に **REP** を付けて示されたターゲットになります。

フェイルオーバーは、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}から、**「ストレージ」**、「**{{site.data.keyword.blockstorageshort}}」**で開始されます。

**このプロセスを先に進める前に、ボリュームを切り離すことをお勧めします。 そうしないと、データの破損や損失が発生します。**

1. アクティブな LUN (「ソース」) をクリックします。
2. **「レプリカ」**タブをクリックし、右上隅の**「アクション」**リンクをクリックします。
3. 「フェイルオーバー」を選択します。
   ページの上部に、フェイルオーバーが進行中であることを示すメッセージが表示されます。 また、**{{site.data.keyword.blockstorageshort}}**のボリュームの横にアイコンが表示され、アクティブ・トランザクションが実行されていることを示します。 アイコンの上にカーソルを移動すると、トランザクションを示すダイアログが生成されます。 アイコンは、トランザクションが完了すると表示されなくなります。 フェイルオーバー・プロセス中、構成に関連したアクションは読み取り専用になります。スナップショット・スケジュールの編集やスナップショット・スペースの変更などは実行できません。 このイベントは、レプリケーション履歴にログとして記録されます。
   ターゲット・ボリュームが稼働状態になると、別のメッセージが表示されます。 元のソース・ボリュームの「LUN 名」の後に REP が付けられ、その「状況」は「非アクティブ」になります。
4. 右上隅の**「すべて表示」** (**{{site.data.keyword.blockstorageshort}}**) リンクをクリックします。
5. アクティブな LUN (以前のターゲット・ボリューム) をクリックします。 これにより、このボリュームの状況が**「アクティブ」**になります。
6. ストレージ・ボリュームをホストにマウントして、接続します。 手順については、[ここ](provisioning-block_storage.html)をクリックしてください。


## ボリュームからそのレプリカへのフェイルバックの開始方法

元のソース・ボリュームが修復された後、**「フェイルバック」**アクションを使用して、元のソース・ボリュームへの制御付きフェイルバックを開始することができます。制御付きフェイルバックでは、

- 作動中のソース・ボリュームがオフラインにされ、
- スナップショットが取得され、
- レプリケーション・サイクルが完了し、
- 作成されたばかりのデータ・スナップショットがアクティブ化され、
- ソース・ボリュームがマウント用にアクティブ化される。

フェイルバックが開始されると、**レプリケーション関係が再び反転する**ことに注意してください。ソース・ボリュームはソース・ボリュームとして復元され、ターゲット・ボリュームは再び、**「LUN 名」**の後に **REP** を付けて示されたターゲット・ボリュームになります。

フェイルバックは、[{{site.data.keyword.slportal}}](https://control.softlayer.com/){:new_window}から、**「ストレージ」**、**「{{site.data.keyword.blockstorageshort}}」**で開始されます。

1. アクティブな Endurance LUN (「ターゲット」) をクリックします。
2. **「レプリカ」**タブをクリックし、右上隅の**「アクション」**リンクをクリックします。
3. **「フェイルバック」**を選択します。
   ページの上部に、フェイルオーバーが進行中であることを示すメッセージが表示されます。 また、**{{site.data.keyword.blockstorageshort}}**のボリュームの横にアイコンが表示され、アクティブ・トランザクションが実行されていることを示します。 アイコンの上にカーソルを移動すると、トランザクションを示すダイアログが生成されます。 アイコンは、トランザクションが完了すると表示されなくなります。 フェイルバック・プロセス中、構成に関連したアクションは読み取り専用になります。スナップショット・スケジュールの編集やスナップショット・スペースの変更などはできません。このイベントは、レプリケーション履歴にログとして記録されます。
   ソース・ボリュームが稼働状態になると、別のメッセージが表示されます。 これにより、ターゲット・ボリュームが非アクティブ状態になります。
4. 右上隅の**「すべて表示」** (**{{site.data.keyword.blockstorageshort}}**) リンクをクリックします。
5. アクティブな Endurance LUN (ソース) をクリックします。 これにより、このボリュームの状況が**「アクティブ」**になります。
6. ストレージ・ボリュームをホストにマウントして、接続します。 手順については、[ここ](provisioning-block_storage.html)をクリックしてください。


## 自分のレプリケーション履歴の表示方法

レプリケーション履歴は、**「管理」**の**「アカウント」**タブを介して、**「監査ログ」**に表示されます。 プライマリー・ボリュームとレプリカ・ボリュームは、どちらも同じレプリケーション履歴を表示し、それには以下のデータが含まれます。

- レプリケーションのタイプ (フェイルオーバーまたはフェイルバック)
- 開始日時
- レプリケーションに使用されたスナップショット
- レプリケーションのサイズ
- 完了日時


## 既存のレプリケーションのキャンセル方法

キャンセルは、即時に実行することも、請求料金の確定日に実行することもできます。これにより、課金が終了します。 レプリケーションのキャンセルは、**「プライマリー (Primary)」**と**「レプリカ」**のどちらのタブからでも行うことができます。

1. **「{{site.data.keyword.blockstorageshort}}」**ページからボリュームをクリックします。
2. **「プライマリー (Primary)」**または**「レプリカ」**のいずれかのタブで、**「アクション」**ドロップダウンをクリックします。
3. **「レプリカのキャンセル」**を選択します。
4. いつキャンセルするか (**「即時」**または**「請求料金の確定日」**) を選択して、**「続行」**をクリックします。
5. **「私は、キャンセルによりデータ損失が生じる可能性があることを了解します」**チェック・ボックスをクリックして、**「レプリカのキャンセル」**をクリックします。


## プライマリー・ボリュームがキャンセルされたときにレプリケーションをキャンセルする方法

プライマリー・ボリュームがキャンセルされると、レプリケーション・スケジュールとレプリカ・データ・センター内のボリュームが削除されます。 レプリカのキャンセルは、「{{site.data.keyword.blockstorageshort}}」ページから行います。

 1. **「{{site.data.keyword.blockstorageshort}}」**ページで、ボリュームを強調表示します。
 2. **「アクション」**ドロップダウン・メニューをクリックして、**「 {{site.data.keyword.blockstorageshort}}のキャンセル」**を選択します。
 3. ボリュームをいつキャンセルするか (**「即時」**または**「請求料金の確定日」**) を選択して、**「続行」**をクリックします。
 4. **「私は、キャンセルによりデータ損失が生じる可能性があることを了解します」**チェック・ボックスをクリックして、**「キャンセル」**をクリックします。
